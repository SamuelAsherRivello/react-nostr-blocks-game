import{r as C,j as A}from"./react-B1CnsdDo.js";import{L as se,T as We,R as Ve,U as Xe,a as $e,O as Ye,P as Ke,S as be,b as ae,N as Je,A as Qe,B as Ze,M as et,C as tt,W as nt,c as rt,d as ot,e as it,V as st,f as K,g as at,h as ct,i as lt,j as ft,k as ye,H as ut,D as dt,F as pt}from"./three-CCrdGQtI.js";import{c as _e}from"./debounce-Cd30_yT5.js";import{F as vt,u as ht}from"./its-fine-BPHwE9FS.js";import{R as mt,c as U}from"./react-reconciler-CJGypQHA.js";import{s as Ee}from"./scheduler-CzFDRTuY.js";import{_ as je}from"./@babel-DgsEKXq2.js";import{O as gt}from"./three-stdlib-DZXZtruj.js";import{c as wt}from"./zustand-BsR6LOud.js";const we={},bt=e=>void Object.assign(we,e);function yt(e,r){function i(t,{args:n=[],attach:s,...v},h){let w=`${t[0].toUpperCase()}${t.slice(1)}`,c;if(t==="primitive"){if(v.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const o=v.object;c=q(o,{type:t,root:h,attach:s,primitive:!0})}else{const o=we[w];if(!o)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");c=q(new o(...n),{type:t,root:h,attach:s,memoizedProps:{args:n}})}return c.__r3f.attach===void 0&&(c instanceof Ze?c.__r3f.attach="geometry":c instanceof et&&(c.__r3f.attach="material")),w!=="inject"&&fe(c,v),c}function a(t,n){let s=!1;if(n){var v,h;(v=n.__r3f)!=null&&v.attach?le(t,n,n.__r3f.attach):n.isObject3D&&t.isObject3D&&(t.add(n),s=!0),s||(h=t.__r3f)==null||h.objects.push(n),n.__r3f||q(n,{}),n.__r3f.parent=t,ge(n),G(n)}}function d(t,n,s){let v=!1;if(n){var h,w;if((h=n.__r3f)!=null&&h.attach)le(t,n,n.__r3f.attach);else if(n.isObject3D&&t.isObject3D){n.parent=t,n.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:n});const c=t.children.filter(p=>p!==n),o=c.indexOf(s);t.children=[...c.slice(0,o),n,...c.slice(o)],v=!0}v||(w=t.__r3f)==null||w.objects.push(n),n.__r3f||q(n,{}),n.__r3f.parent=t,ge(n),G(n)}}function f(t,n,s=!1){t&&[...t].forEach(v=>g(n,v,s))}function g(t,n,s){if(n){var v,h,w;if(n.__r3f&&(n.__r3f.parent=null),(v=t.__r3f)!=null&&v.objects&&(t.__r3f.objects=t.__r3f.objects.filter(S=>S!==n)),(h=n.__r3f)!=null&&h.attach)xe(t,n,n.__r3f.attach);else if(n.isObject3D&&t.isObject3D){var c;t.remove(n),(c=n.__r3f)!=null&&c.root&&Ot(re(n),n)}const p=(w=n.__r3f)==null?void 0:w.primitive,b=!p&&(s===void 0?n.dispose!==null:s);if(!p){var o;f((o=n.__r3f)==null?void 0:o.objects,n,b),f(n.children,n,b)}if(delete n.__r3f,b&&n.dispose&&n.type!=="Scene"){const S=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ee.unstable_scheduleCallback(Ee.unstable_IdlePriority,S):S()}G(t)}}function l(t,n,s,v){var h;const w=(h=t.__r3f)==null?void 0:h.parent;if(!w)return;const c=i(n,s,t.__r3f.root);if(t.children){for(const o of t.children)o.__r3f&&a(c,o);t.children=t.children.filter(o=>!o.__r3f)}t.__r3f.objects.forEach(o=>a(c,o)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||g(w,t),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),a(w,c),c.raycast&&c.__r3f.eventCount&&re(c).getState().internal.interaction.push(c),[v,v.alternate].forEach(o=>{o!==null&&(o.stateNode=c,o.ref&&(typeof o.ref=="function"?o.ref(c):o.ref.current=c))})}const u=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:mt({createInstance:i,removeChild:g,appendChild:a,appendInitialChild:a,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,n)=>{if(!n)return;const s=t.getState().scene;s.__r3f&&(s.__r3f.root=t,a(s,n))},removeChildFromContainer:(t,n)=>{n&&g(t.getState().scene,n)},insertInContainerBefore:(t,n,s)=>{if(!n||!s)return;const v=t.getState().scene;v.__r3f&&d(v,n,s)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var n;return!!((n=t==null?void 0:t.__r3f)!=null?n:{}).handlers},prepareUpdate(t,n,s,v){var h;if(((h=t==null?void 0:t.__r3f)!=null?h:{}).primitive&&v.object&&v.object!==t)return[!0];{const{args:c=[],children:o,...p}=v,{args:b=[],children:S,...E}=s;if(!Array.isArray(c))throw new Error("R3F: the args prop must be an array!");if(c.some((x,O)=>x!==b[O]))return[!0];const y=Fe(t,p,E,!0);return y.changes.length?[!1,y]:null}},commitUpdate(t,[n,s],v,h,w,c){n?l(t,v,w,c):fe(t,s)},commitMount(t,n,s,v){var h;const w=(h=t.__r3f)!=null?h:{};t.raycast&&w.handlers&&w.eventCount&&re(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>q(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var n;const{attach:s,parent:v}=(n=t.__r3f)!=null?n:{};s&&v&&xe(v,t,s),t.isObject3D&&(t.visible=!1),G(t)},unhideInstance(t,n){var s;const{attach:v,parent:h}=(s=t.__r3f)!=null?s:{};v&&h&&le(h,t,v),(t.isObject3D&&n.visible==null||n.visible)&&(t.visible=!0),G(t)},createTextInstance:u,hideTextInstance:u,unhideTextInstance:u,getCurrentEventPriority:()=>r?r():U.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&R.fun(performance.now)?performance.now:R.fun(Date.now)?Date.now:()=>0,scheduleTimeout:R.fun(setTimeout)?setTimeout:void 0,cancelTimeout:R.fun(clearTimeout)?clearTimeout:void 0}),applyProps:fe}}var Ce,Se;const ce=e=>"colorSpace"in e||"outputColorSpace"in e,Te=()=>{var e;return(e=we.ColorManagement)!=null?e:null},Le=e=>e&&e.isOrthographicCamera,_t=e=>e&&e.hasOwnProperty("current"),J=typeof window<"u"&&((Ce=window.document)!=null&&Ce.createElement||((Se=window.navigator)==null?void 0:Se.product)==="ReactNative")?C.useLayoutEffect:C.useEffect;function ze(e){const r=C.useRef(e);return J(()=>void(r.current=e),[e]),r}function Et({set:e}){return J(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ke extends C.Component{constructor(...r){super(...r),this.state={error:!1}}componentDidCatch(r){this.props.set(r)}render(){return this.state.error?null:this.props.children}}ke.getDerivedStateFromError=()=>({error:!0});const De="__default",Pe=new Map,Ct=e=>e&&!!e.memoized&&!!e.changes;function Ae(e){var r;const i=typeof window<"u"?(r=window.devicePixelRatio)!=null?r:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const $=e=>{var r;return(r=e.__r3f)==null?void 0:r.root.getState()};function re(e){let r=e.__r3f.root;for(;r.getState().previousRoot;)r=r.getState().previousRoot;return r}const R={obj:e=>e===Object(e)&&!R.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,r,{arrays:i="shallow",objects:a="reference",strict:d=!0}={}){if(typeof e!=typeof r||!!e!=!!r)return!1;if(R.str(e)||R.num(e)||R.boo(e))return e===r;const f=R.obj(e);if(f&&a==="reference")return e===r;const g=R.arr(e);if(g&&i==="reference")return e===r;if((g||f)&&e===r)return!0;let l;for(l in e)if(!(l in r))return!1;if(f&&i==="shallow"&&a==="shallow"){for(l in d?r:e)if(!R.equ(e[l],r[l],{strict:d,objects:"reference"}))return!1}else for(l in d?r:e)if(e[l]!==r[l])return!1;if(R.und(l)){if(g&&e.length===0&&r.length===0||f&&Object.keys(e).length===0&&Object.keys(r).length===0)return!0;if(e!==r)return!1}return!0}};function St(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const r in e)r.dispose==null||r.dispose(),delete e[r]}function q(e,r){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...r},e}function me(e,r){let i=e;if(r.includes("-")){const a=r.split("-"),d=a.pop();return i=a.reduce((f,g)=>f[g],e),{target:i,key:d}}else return{target:i,key:r}}const Me=/-\d+$/;function le(e,r,i){if(R.str(i)){if(Me.test(i)){const f=i.replace(Me,""),{target:g,key:l}=me(e,f);Array.isArray(g[l])||(g[l]=[])}const{target:a,key:d}=me(e,i);r.__r3f.previousAttach=a[d],a[d]=r}else r.__r3f.previousAttach=i(e,r)}function xe(e,r,i){var a,d;if(R.str(i)){const{target:f,key:g}=me(e,i),l=r.__r3f.previousAttach;l===void 0?delete f[g]:f[g]=l}else(a=r.__r3f)==null||a.previousAttach==null||a.previousAttach(e,r);(d=r.__r3f)==null||delete d.previousAttach}function Fe(e,{children:r,key:i,ref:a,...d},{children:f,key:g,ref:l,...u}={},m=!1){const t=e.__r3f,n=Object.entries(d),s=[];if(m){const h=Object.keys(u);for(let w=0;w<h.length;w++)d.hasOwnProperty(h[w])||n.unshift([h[w],De+"remove"])}n.forEach(([h,w])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&h==="object"||R.equ(w,u[h]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(h))return s.push([h,w,!0,[]]);let o=[];h.includes("-")&&(o=h.split("-")),s.push([h,w,!1,o]);for(const p in d){const b=d[p];p.startsWith(`${h}-`)&&s.push([p,b,!1,p.split("-")])}});const v={...d};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(v.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(v.attach=t.memoizedProps.attach),{memoized:v,changes:s}}const Pt=typeof process<"u"&&!1;function fe(e,r){var i;const a=e.__r3f,d=a==null?void 0:a.root,f=d==null||d.getState==null?void 0:d.getState(),{memoized:g,changes:l}=Ct(r)?r:Fe(e,r),u=a==null?void 0:a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=g);for(let t=0;t<l.length;t++){let[n,s,v,h]=l[t];if(ce(e)){const p="srgb",b="srgb-linear";n==="encoding"?(n="colorSpace",s=s===3001?p:b):n==="outputEncoding"&&(n="outputColorSpace",s=s===3001?p:b)}let w=e,c=w[n];if(h.length&&(c=h.reduce((o,p)=>o[p],e),!(c&&c.set))){const[o,...p]=h.reverse();w=p.reverse().reduce((b,S)=>b[S],e),n=o}if(s===De+"remove")if(w.constructor){let o=Pe.get(w.constructor);o||(o=new w.constructor,Pe.set(w.constructor,o)),s=o[n]}else s=0;if(v&&a)s?a.handlers[n]=s:delete a.handlers[n],a.eventCount=Object.keys(a.handlers).length;else if(c&&c.set&&(c.copy||c instanceof se)){if(Array.isArray(s))c.fromArray?c.fromArray(s):c.set(...s);else if(c.copy&&s&&s.constructor&&(Pt?c.constructor.name===s.constructor.name:c.constructor===s.constructor))c.copy(s);else if(s!==void 0){const o=c instanceof tt;!o&&c.setScalar?c.setScalar(s):c instanceof se&&s instanceof se?c.mask=s.mask:c.set(s),!Te()&&f&&!f.linear&&o&&c.convertSRGBToLinear()}}else if(w[n]=s,w[n]instanceof We&&w[n].format===Ve&&w[n].type===Xe&&f){const o=w[n];ce(o)&&ce(f.gl)?o.colorSpace=f.gl.outputColorSpace:o.encoding=f.gl.outputEncoding}G(e)}if(a&&a.parent&&e.raycast&&u!==a.eventCount){const t=re(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),a.eventCount&&t.interaction.push(e)}return!(l.length===1&&l[0][0]==="onUpdate")&&l.length&&(i=e.__r3f)!=null&&i.parent&&ge(e),e}function G(e){var r,i;const a=(r=e.__r3f)==null||(i=r.root)==null||i.getState==null?void 0:i.getState();a&&a.internal.frames===0&&a.invalidate()}function ge(e){e.onUpdate==null||e.onUpdate(e)}function Mt(e,r){e.manual||(Le(e)?(e.left=r.width/-2,e.right=r.width/2,e.top=r.height/2,e.bottom=r.height/-2):e.aspect=r.width/r.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function te(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function xt(){var e;const r=typeof self<"u"&&self||typeof window<"u"&&window;if(!r)return U.DefaultEventPriority;switch((e=r.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return U.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return U.ContinuousEventPriority;default:return U.DefaultEventPriority}}function Be(e,r,i,a){const d=i.get(r);d&&(i.delete(r),i.size===0&&(e.delete(a),d.target.releasePointerCapture(a)))}function Ot(e,r){const{internal:i}=e.getState();i.interaction=i.interaction.filter(a=>a!==r),i.initialHits=i.initialHits.filter(a=>a!==r),i.hovered.forEach((a,d)=>{(a.eventObject===r||a.object===r)&&i.hovered.delete(d)}),i.capturedMap.forEach((a,d)=>{Be(i.capturedMap,r,a,d)})}function Rt(e){function r(u){const{internal:m}=e.getState(),t=u.offsetX-m.initialClick[0],n=u.offsetY-m.initialClick[1];return Math.round(Math.sqrt(t*t+n*n))}function i(u){return u.filter(m=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return(n=m.__r3f)==null?void 0:n.handlers["onPointer"+t]}))}function a(u,m){const t=e.getState(),n=new Set,s=[],v=m?m(t.internal.interaction):t.internal.interaction;for(let o=0;o<v.length;o++){const p=$(v[o]);p&&(p.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(u,t);function h(o){const p=$(o);if(!p||!p.events.enabled||p.raycaster.camera===null)return[];if(p.raycaster.camera===void 0){var b;p.events.compute==null||p.events.compute(u,p,(b=p.previousRoot)==null?void 0:b.getState()),p.raycaster.camera===void 0&&(p.raycaster.camera=null)}return p.raycaster.camera?p.raycaster.intersectObject(o,!0):[]}let w=v.flatMap(h).sort((o,p)=>{const b=$(o.object),S=$(p.object);return!b||!S?o.distance-p.distance:S.events.priority-b.events.priority||o.distance-p.distance}).filter(o=>{const p=te(o);return n.has(p)?!1:(n.add(p),!0)});t.events.filter&&(w=t.events.filter(w,t));for(const o of w){let p=o.object;for(;p;){var c;(c=p.__r3f)!=null&&c.eventCount&&s.push({...o,eventObject:p}),p=p.parent}}if("pointerId"in u&&t.internal.capturedMap.has(u.pointerId))for(let o of t.internal.capturedMap.get(u.pointerId).values())n.has(te(o.intersection))||s.push(o.intersection);return s}function d(u,m,t,n){const s=e.getState();if(u.length){const v={stopped:!1};for(const h of u){const w=$(h.object)||s,{raycaster:c,pointer:o,camera:p,internal:b}=w,S=new K(o.x,o.y,0).unproject(p),E=M=>{var _,j;return(_=(j=b.capturedMap.get(M))==null?void 0:j.has(h.eventObject))!=null?_:!1},y=M=>{const _={intersection:h,target:m.target};b.capturedMap.has(M)?b.capturedMap.get(M).set(h.eventObject,_):b.capturedMap.set(M,new Map([[h.eventObject,_]])),m.target.setPointerCapture(M)},x=M=>{const _=b.capturedMap.get(M);_&&Be(b.capturedMap,h.eventObject,_,M)};let O={};for(let M in m){let _=m[M];typeof _!="function"&&(O[M]=_)}let P={...h,...O,pointer:o,intersections:u,stopped:v.stopped,delta:t,unprojectedPoint:S,ray:c.ray,camera:p,stopPropagation(){const M="pointerId"in m&&b.capturedMap.get(m.pointerId);if((!M||M.has(h.eventObject))&&(P.stopped=v.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(_=>_.eventObject===h.eventObject))){const _=u.slice(0,u.indexOf(h));f([..._,h])}},target:{hasPointerCapture:E,setPointerCapture:y,releasePointerCapture:x},currentTarget:{hasPointerCapture:E,setPointerCapture:y,releasePointerCapture:x},nativeEvent:m};if(n(P),v.stopped===!0)break}}return u}function f(u){const{internal:m}=e.getState();for(const t of m.hovered.values())if(!u.length||!u.find(n=>n.object===t.object&&n.index===t.index&&n.instanceId===t.instanceId)){const s=t.eventObject.__r3f,v=s==null?void 0:s.handlers;if(m.hovered.delete(te(t)),s!=null&&s.eventCount){const h={...t,intersections:u};v.onPointerOut==null||v.onPointerOut(h),v.onPointerLeave==null||v.onPointerLeave(h)}}}function g(u,m){for(let t=0;t<m.length;t++){const n=m[t].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(u)}}function l(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>f([]);case"onLostPointerCapture":return m=>{const{internal:t}=e.getState();"pointerId"in m&&t.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(m.pointerId)&&(t.capturedMap.delete(m.pointerId),f([]))})}}return function(t){const{onPointerMissed:n,internal:s}=e.getState();s.lastEvent.current=t;const v=u==="onPointerMove",h=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",c=a(t,v?i:void 0),o=h?r(t):0;u==="onPointerDown"&&(s.initialClick=[t.offsetX,t.offsetY],s.initialHits=c.map(b=>b.eventObject)),h&&!c.length&&o<=2&&(g(t,s.interaction),n&&n(t)),v&&f(c);function p(b){const S=b.eventObject,E=S.__r3f,y=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(v){if(y.onPointerOver||y.onPointerEnter||y.onPointerOut||y.onPointerLeave){const x=te(b),O=s.hovered.get(x);O?O.stopped&&b.stopPropagation():(s.hovered.set(x,b),y.onPointerOver==null||y.onPointerOver(b),y.onPointerEnter==null||y.onPointerEnter(b))}y.onPointerMove==null||y.onPointerMove(b)}else{const x=y[u];x?(!h||s.initialHits.includes(S))&&(g(t,s.interaction.filter(O=>!s.initialHits.includes(O))),x(b)):h&&s.initialHits.includes(S)&&g(t,s.interaction.filter(O=>!s.initialHits.includes(O)))}}d(c,t,o,p)}}return{handlePointer:l}}const Ie=e=>!!(e!=null&&e.render),He=C.createContext(null),jt=(e,r)=>{const i=wt((l,u)=>{const m=new K,t=new K,n=new K;function s(o=u().camera,p=t,b=u().size){const{width:S,height:E,top:y,left:x}=b,O=S/E;p instanceof K?n.copy(p):n.set(...p);const P=o.getWorldPosition(m).distanceTo(n);if(Le(o))return{width:S/o.zoom,height:E/o.zoom,top:y,left:x,factor:1,distance:P,aspect:O};{const M=o.fov*Math.PI/180,_=2*Math.tan(M/2)*P,j=_*(S/E);return{width:j,height:_,top:y,left:x,factor:S/j,distance:P,aspect:O}}}let v;const h=o=>l(p=>({performance:{...p.performance,current:o}})),w=new at;return{set:l,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(o=1)=>e(u(),o),advance:(o,p)=>r(o,p,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ct,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const o=u();v&&clearTimeout(v),o.performance.current!==o.performance.min&&h(o.performance.min),v=setTimeout(()=>h(u().performance.max),o.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:o=>l(p=>({...p,events:{...p.events,...o}})),setSize:(o,p,b,S,E)=>{const y=u().camera,x={width:o,height:p,top:S||0,left:E||0,updateStyle:b};l(O=>({size:x,viewport:{...O.viewport,...s(y,t,x)}}))},setDpr:o=>l(p=>{const b=Ae(o);return{viewport:{...p.viewport,dpr:b,initialDpr:p.viewport.initialDpr||b}}}),setFrameloop:(o="always")=>{const p=u().clock;p.stop(),p.elapsedTime=0,o!=="never"&&(p.start(),p.elapsedTime=0),l(()=>({frameloop:o}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:C.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(o,p,b)=>{const S=u().internal;return S.priority=S.priority+(p>0?1:0),S.subscribers.push({ref:o,priority:p,store:b}),S.subscribers=S.subscribers.sort((E,y)=>E.priority-y.priority),()=>{const E=u().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(p>0?1:0),E.subscribers=E.subscribers.filter(y=>y.ref!==o))}}}}}),a=i.getState();let d=a.size,f=a.viewport.dpr,g=a.camera;return i.subscribe(()=>{const{camera:l,size:u,viewport:m,gl:t,set:n}=i.getState();if(u.width!==d.width||u.height!==d.height||m.dpr!==f){var s;d=u,f=m.dpr,Mt(l,u),t.setPixelRatio(m.dpr);const v=(s=u.updateStyle)!=null?s:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(u.width,u.height,v)}l!==g&&(g=l,n(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(l)}})))}),i.subscribe(l=>e(l)),i};let ne,Tt=new Set,Lt=new Set,zt=new Set;function ue(e,r){if(e.size)for(const{callback:i}of e.values())i(r)}function Y(e,r){switch(e){case"before":return ue(Tt,r);case"after":return ue(Lt,r);case"tail":return ue(zt,r)}}let de,pe;function ve(e,r,i){let a=r.clock.getDelta();for(r.frameloop==="never"&&typeof e=="number"&&(a=e-r.clock.elapsedTime,r.clock.oldTime=r.clock.elapsedTime,r.clock.elapsedTime=e),de=r.internal.subscribers,ne=0;ne<de.length;ne++)pe=de[ne],pe.ref.current(pe.store.getState(),a,i);return!r.internal.priority&&r.gl.render&&r.gl.render(r.scene,r.camera),r.internal.frames=Math.max(0,r.internal.frames-1),r.frameloop==="always"?1:r.internal.frames}function kt(e){let r=!1,i=!1,a,d,f;function g(m){d=requestAnimationFrame(g),r=!0,a=0,Y("before",m),i=!0;for(const n of e.values()){var t;f=n.store.getState(),f.internal.active&&(f.frameloop==="always"||f.internal.frames>0)&&!((t=f.gl.xr)!=null&&t.isPresenting)&&(a+=ve(m,f))}if(i=!1,Y("after",m),a===0)return Y("tail",m),r=!1,cancelAnimationFrame(d)}function l(m,t=1){var n;if(!m)return e.forEach(s=>l(s.store.getState(),t));(n=m.gl.xr)!=null&&n.isPresenting||!m.internal.active||m.frameloop==="never"||(t>1?m.internal.frames=Math.min(60,m.internal.frames+t):i?m.internal.frames=2:m.internal.frames=1,r||(r=!0,requestAnimationFrame(g)))}function u(m,t=!0,n,s){if(t&&Y("before",m),n)ve(m,n,s);else for(const v of e.values())ve(m,v.store.getState());t&&Y("after",m)}return{loop:g,invalidate:l,advance:u}}function Ne(){const e=C.useContext(He);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function k(e=i=>i,r){return Ne()(e,r)}function qe(e,r=0){const i=Ne(),a=i.getState().internal.subscribe,d=ze(e);return J(()=>a(d,r,i),[r,a,i]),null}const W=new Map,{invalidate:Oe,advance:Re}=kt(W),{reconciler:oe,applyProps:H}=yt(W,xt),N={objects:"shallow",strict:!1},Dt=(e,r)=>{const i=typeof e=="function"?e(r):e;return Ie(i)?i:new nt({powerPreference:"high-performance",canvas:r,antialias:!0,alpha:!0,...e})};function At(e,r){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(r){const{width:a,height:d,top:f,left:g,updateStyle:l=i}=r;return{width:a,height:d,top:f,left:g,updateStyle:l}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:a,height:d,top:f,left:g}=e.parentElement.getBoundingClientRect();return{width:a,height:d,top:f,left:g,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function Ft(e){const r=W.get(e),i=r==null?void 0:r.fiber,a=r==null?void 0:r.store;r&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,f=a||jt(Oe,Re),g=i||oe.createContainer(f,U.ConcurrentRoot,null,!1,null,"",d,null);r||W.set(e,{fiber:g,store:f});let l,u=!1,m;return{configure(t={}){let{gl:n,size:s,scene:v,events:h,onCreated:w,shadows:c=!1,linear:o=!1,flat:p=!1,legacy:b=!1,orthographic:S=!1,frameloop:E="always",dpr:y=[1,2],performance:x,raycaster:O,camera:P,onPointerMissed:M}=t,_=f.getState(),j=_.gl;_.gl||_.set({gl:j=Dt(n,e)});let D=_.raycaster;D||_.set({raycaster:D=new $e});const{params:V,...Q}=O||{};if(R.equ(Q,D,N)||H(D,{...Q}),R.equ(V,D.params,N)||H(D,{params:{...D.params,...V}}),!_.camera||_.camera===m&&!R.equ(m,P,N)){m=P;const z=P instanceof rt,T=z?P:S?new Ye(0,0,0,0,.1,1e3):new Ke(75,0,.1,1e3);z||(T.position.z=5,P&&(H(T,P),("aspect"in P||"left"in P||"right"in P||"bottom"in P||"top"in P)&&(T.manual=!0,T.updateProjectionMatrix())),!_.camera&&!(P!=null&&P.rotation)&&T.lookAt(0,0,0)),_.set({camera:T}),D.camera=T}if(!_.scene){let z;v instanceof be?z=v:(z=new be,v&&H(z,v)),_.set({scene:q(z)})}if(!_.xr){var X;const z=(L,ie)=>{const ee=f.getState();ee.frameloop!=="never"&&Re(L,!0,ee,ie)},T=()=>{const L=f.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?z:null),L.gl.xr.isPresenting||Oe(L)},I={connect(){const L=f.getState().gl;L.xr.addEventListener("sessionstart",T),L.xr.addEventListener("sessionend",T)},disconnect(){const L=f.getState().gl;L.xr.removeEventListener("sessionstart",T),L.xr.removeEventListener("sessionend",T)}};typeof((X=j.xr)==null?void 0:X.addEventListener)=="function"&&I.connect(),_.set({xr:I})}if(j.shadowMap){const z=j.shadowMap.enabled,T=j.shadowMap.type;if(j.shadowMap.enabled=!!c,R.boo(c))j.shadowMap.type=ae;else if(R.str(c)){var Z;const I={basic:ot,percentage:it,soft:ae,variance:st};j.shadowMap.type=(Z=I[c])!=null?Z:ae}else R.obj(c)&&Object.assign(j.shadowMap,c);(z!==j.shadowMap.enabled||T!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const F=Te();F&&("enabled"in F?F.enabled=!b:"legacyMode"in F&&(F.legacyMode=b)),u||H(j,{outputEncoding:o?3e3:3001,toneMapping:p?Je:Qe}),_.legacy!==b&&_.set(()=>({legacy:b})),_.linear!==o&&_.set(()=>({linear:o})),_.flat!==p&&_.set(()=>({flat:p})),n&&!R.fun(n)&&!Ie(n)&&!R.equ(n,j,N)&&H(j,n),h&&!_.events.handlers&&_.set({events:h(f)});const B=At(e,s);return R.equ(B,_.size,N)||_.setSize(B.width,B.height,B.updateStyle,B.top,B.left),y&&_.viewport.dpr!==Ae(y)&&_.setDpr(y),_.frameloop!==E&&_.setFrameloop(E),_.onPointerMissed||_.set({onPointerMissed:M}),x&&!R.equ(x,_.performance,N)&&_.set(z=>({performance:{...z.performance,...x}})),l=w,u=!0,this},render(t){return u||this.configure(),oe.updateContainer(A.jsx(Bt,{store:f,children:t,onCreated:l,rootElement:e}),g,null,()=>{}),f},unmount(){Ge(e)}}}function Bt({store:e,children:r,onCreated:i,rootElement:a}){return J(()=>{const d=e.getState();d.set(f=>({internal:{...f.internal,active:!0}})),i&&i(d),e.getState().events.connected||d.events.connect==null||d.events.connect(a)},[]),A.jsx(He.Provider,{value:e,children:r})}function Ge(e,r){const i=W.get(e),a=i==null?void 0:i.fiber;if(a){const d=i==null?void 0:i.store.getState();d&&(d.internal.active=!1),oe.updateContainer(null,a,null,()=>{d&&setTimeout(()=>{try{var f,g,l,u;d.events.disconnect==null||d.events.disconnect(),(f=d.gl)==null||(g=f.renderLists)==null||g.dispose==null||g.dispose(),(l=d.gl)==null||l.forceContextLoss==null||l.forceContextLoss(),(u=d.gl)!=null&&u.xr&&d.xr.disconnect(),St(d),W.delete(e)}catch{}},500)})}}oe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:C.version});const he={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function It(e){const{handlePointer:r}=Rt(e);return{priority:1,enabled:!0,compute(i,a,d){a.pointer.set(i.offsetX/a.size.width*2-1,-(i.offsetY/a.size.height)*2+1),a.raycaster.setFromCamera(a.pointer,a.camera)},connected:void 0,handlers:Object.keys(he).reduce((i,a)=>({...i,[a]:r(a)}),{}),update:()=>{var i;const{events:a,internal:d}=e.getState();(i=d.lastEvent)!=null&&i.current&&a.handlers&&a.handlers.onPointerMove(d.lastEvent.current)},connect:i=>{var a;const{set:d,events:f}=e.getState();f.disconnect==null||f.disconnect(),d(g=>({events:{...g.events,connected:i}})),Object.entries((a=f.handlers)!=null?a:[]).forEach(([g,l])=>{const[u,m]=he[g];i.addEventListener(u,l,{passive:m})})},disconnect:()=>{const{set:i,events:a}=e.getState();if(a.connected){var d;Object.entries((d=a.handlers)!=null?d:[]).forEach(([f,g])=>{if(a&&a.connected instanceof HTMLElement){const[l]=he[f];a.connected.removeEventListener(l,g)}}),i(f=>({events:{...f.events,connected:void 0}}))}}}}function Ht({debounce:e,scroll:r,polyfill:i,offsetSize:a}={debounce:0,scroll:!1,offsetSize:!1}){const d=i||typeof window<"u"&&window.ResizeObserver,[f,g]=C.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!d)return f.width=1280,f.height=800,[()=>{},f,()=>{}];const l=C.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:f}),u=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,t=C.useRef(!1);C.useEffect(()=>(t.current=!0,()=>void(t.current=!1)));const[n,s,v]=C.useMemo(()=>{const o=()=>{if(!l.current.element)return;const{left:p,top:b,width:S,height:E,bottom:y,right:x,x:O,y:P}=l.current.element.getBoundingClientRect(),M={left:p,top:b,width:S,height:E,bottom:y,right:x,x:O,y:P};l.current.element instanceof HTMLElement&&a&&(M.height=l.current.element.offsetHeight,M.width=l.current.element.offsetWidth),Object.freeze(M),t.current&&!Ut(l.current.lastBounds,M)&&g(l.current.lastBounds=M)};return[o,m?_e(o,m):o,u?_e(o,u):o]},[g,a,u,m]);function h(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(o=>o.removeEventListener("scroll",v,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function w(){l.current.element&&(l.current.resizeObserver=new d(v),l.current.resizeObserver.observe(l.current.element),r&&l.current.scrollContainers&&l.current.scrollContainers.forEach(o=>o.addEventListener("scroll",v,{capture:!0,passive:!0})))}const c=o=>{!o||o===l.current.element||(h(),l.current.element=o,l.current.scrollContainers=Ue(o),w())};return qt(v,!!r),Nt(s),C.useEffect(()=>{h(),w()},[r,v,s]),C.useEffect(()=>h,[]),[c,f,n]}function Nt(e){C.useEffect(()=>{const r=e;return window.addEventListener("resize",r),()=>void window.removeEventListener("resize",r)},[e])}function qt(e,r){C.useEffect(()=>{if(r){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,r])}function Ue(e){const r=[];if(!e||e===document.body)return r;const{overflow:i,overflowX:a,overflowY:d}=window.getComputedStyle(e);return[i,a,d].some(f=>f==="auto"||f==="scroll")&&r.push(e),[...r,...Ue(e.parentElement)]}const Gt=["x","y","top","bottom","left","right","width","height"],Ut=(e,r)=>Gt.every(i=>e[i]===r[i]),Wt=C.forwardRef(function({children:r,fallback:i,resize:a,style:d,gl:f,events:g=It,eventSource:l,eventPrefix:u,shadows:m,linear:t,flat:n,legacy:s,orthographic:v,frameloop:h,dpr:w,performance:c,raycaster:o,camera:p,scene:b,onPointerMissed:S,onCreated:E,...y},x){C.useMemo(()=>bt(lt),[]);const O=ht(),[P,M]=Ht({scroll:!0,debounce:{scroll:50,resize:0},...a}),_=C.useRef(null),j=C.useRef(null);C.useImperativeHandle(x,()=>_.current);const D=ze(S),[V,Q]=C.useState(!1),[X,Z]=C.useState(!1);if(V)throw V;if(X)throw X;const F=C.useRef(null);J(()=>{const z=_.current;M.width>0&&M.height>0&&z&&(F.current||(F.current=Ft(z)),F.current.configure({gl:f,events:g,shadows:m,linear:t,flat:n,legacy:s,orthographic:v,frameloop:h,dpr:w,performance:c,raycaster:o,camera:p,scene:b,size:M,onPointerMissed:(...T)=>D.current==null?void 0:D.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(l?_t(l)?l.current:l:j.current),u&&T.setEvents({compute:(I,L)=>{const ie=I[u+"X"],ee=I[u+"Y"];L.pointer.set(ie/L.size.width*2-1,-(ee/L.size.height)*2+1),L.raycaster.setFromCamera(L.pointer,L.camera)}}),E==null||E(T)}}),F.current.render(A.jsx(O,{children:A.jsx(ke,{set:Z,children:A.jsx(C.Suspense,{fallback:A.jsx(Et,{set:Q}),children:r})})})))}),C.useEffect(()=>{const z=_.current;if(z)return()=>Ge(z)},[]);const B=l?"none":"auto";return A.jsx("div",{ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:B,...d},...y,children:A.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:A.jsx("canvas",{ref:_,style:{display:"block"},children:i})})})}),rn=C.forwardRef(function(r,i){return A.jsx(vt,{children:A.jsx(Wt,{...r,ref:i})})});function Vt(e,r,i){const a=k(s=>s.size),d=k(s=>s.viewport),f=typeof e=="number"?e:a.width*d.dpr,g=a.height*d.dpr,l=(typeof e=="number"?i:e)||{},{samples:u=0,depth:m,...t}=l,n=C.useMemo(()=>{const s=new ft(f,g,{minFilter:ye,magFilter:ye,type:ut,...t});return m&&(s.depthTexture=new dt(f,g,pt)),s.samples=u,s},[]);return C.useLayoutEffect(()=>{n.setSize(f,g),u&&(n.samples=u)},[u,n,f,g]),C.useEffect(()=>()=>n.dispose(),[]),n}const Xt=e=>typeof e=="function",on=C.forwardRef(({envMap:e,resolution:r=256,frames:i=1/0,makeDefault:a,children:d,...f},g)=>{const l=k(({set:c})=>c),u=k(({camera:c})=>c),m=k(({size:c})=>c),t=C.useRef(null);C.useImperativeHandle(g,()=>t.current,[]);const n=C.useRef(null),s=Vt(r);C.useLayoutEffect(()=>{f.manual||(t.current.aspect=m.width/m.height)},[m,f]),C.useLayoutEffect(()=>{t.current.updateProjectionMatrix()});let v=0,h=null;const w=Xt(d);return qe(c=>{w&&(i===1/0||v<i)&&(n.current.visible=!1,c.gl.setRenderTarget(s),h=c.scene.background,e&&(c.scene.background=e),c.gl.render(c.scene,t.current),c.scene.background=h,c.gl.setRenderTarget(null),n.current.visible=!0,v++)}),C.useLayoutEffect(()=>{if(a){const c=u;return l(()=>({camera:t.current})),()=>l(()=>({camera:c}))}},[t,a,l]),C.createElement(C.Fragment,null,C.createElement("perspectiveCamera",je({ref:t},f),!w&&d),C.createElement("group",{ref:n},w&&d(s.texture)))}),sn=C.forwardRef(({makeDefault:e,camera:r,regress:i,domElement:a,enableDamping:d=!0,keyEvents:f=!1,onChange:g,onStart:l,onEnd:u,...m},t)=>{const n=k(y=>y.invalidate),s=k(y=>y.camera),v=k(y=>y.gl),h=k(y=>y.events),w=k(y=>y.setEvents),c=k(y=>y.set),o=k(y=>y.get),p=k(y=>y.performance),b=r||s,S=a||h.connected||v.domElement,E=C.useMemo(()=>new gt(b),[b]);return qe(()=>{E.enabled&&E.update()},-1),C.useEffect(()=>(f&&E.connect(f===!0?S:f),E.connect(S),()=>void E.dispose()),[f,S,i,E,n]),C.useEffect(()=>{const y=P=>{n(),i&&p.regress(),g&&g(P)},x=P=>{l&&l(P)},O=P=>{u&&u(P)};return E.addEventListener("change",y),E.addEventListener("start",x),E.addEventListener("end",O),()=>{E.removeEventListener("start",x),E.removeEventListener("end",O),E.removeEventListener("change",y)}},[g,l,u,E,n,w]),C.useEffect(()=>{if(e){const y=o().controls;return c({controls:E}),()=>c({controls:y})}},[e,E]),C.createElement("primitive",je({ref:t,object:E,enableDamping:d},m))});export{rn as C,sn as O,on as P,qe as u};
